<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>p8 Nature - Vocabulary Quiz</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700&display=swap" rel="stylesheet">

<style>
  :root {
    --bg-color: #e3f2fd;
    --text-color: #263238;
    --card-bg: #ffffff;
    --accent-blue: #0277bd;
    --accent-green: #2e7d32;
    --accent-brown: #5d4037;
    --main-font: "Zen Maru Gothic", sans-serif;
  }

  * { font-family: var(--main-font); }

  body {
    background-color: var(--bg-color);
    color: var(--text-color);
    margin: 0;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
  }

  .header-area {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    width: 100%;
    max-width: 1000px;
    margin-bottom: 20px;
    gap: 40px;
  }

  .illustration-container {
    background-color: white;
    padding: 10px;
    border-radius: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    max-width: 350px;
    width: 100%;
  }
  
  .illustration-placeholder {
    width: 100%;
    height: auto;
    border-radius: 15px;
    display: block;
    max-height: 250px;
    object-fit: contain;
  }

  .title-wrapper h2 {
    color: var(--text-color);
    border-bottom: 4px dashed var(--accent-blue);
    padding-bottom: 5px;
    font-size: 1.8rem;
    margin: 0;
  }

  .container {
    background: var(--card-bg);
    width: 100%;
    max-width: 800px;
    padding: 20px;
    border-radius: 25px;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
    text-align: center;
    border: 4px solid #fff;
    margin-bottom: 20px;
    position: relative;
  }

  .question-box {
    font-size: 1.8rem; 
    font-weight: bold;
    margin-bottom: 20px;
    background-color: #f1f8e9;
    border-radius: 15px;
    padding: 25px;
    border: 3px solid #c8e6c9;
    color: var(--text-color);
    min-height: 80px;
    line-height: 1.6;
  }

  .choices-grid {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    margin-bottom: 20px;
  }

  .choice-btn {
    background-color: white;
    border: 3px solid var(--accent-blue);
    color: var(--text-color);
    padding: 12px 20px;
    border-radius: 15px;
    font-size: 1.5rem;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s;
    min-width: 140px;
  }

  .choice-btn:hover { background-color: #e1f5fe; }
  .choice-btn.selected { background-color: var(--accent-blue); color: white; }
  .choice-btn.correct-choice { background-color: var(--accent-green) !important; color: white !important; border-color: var(--accent-green) !important; }
  .choice-btn.wrong-choice { background-color: #d32f2f !important; color: white !important; border-color: #b71c1c !important; }

  .audio-btn {
    position: absolute;
    bottom: 20px;
    right: 20px;
    background-color: #673ab7;
    color: white;
    border: none;
    border-radius: 50px;
    padding: 10px 20px;
    font-size: 1rem;
    cursor: pointer;
    display: none;
    box-shadow: 0 4px 0 #4527a0;
  }

  .action-btn {
    padding: 10px 40px;
    font-size: 1.4rem;
    background-color: var(--accent-green);
    color: white;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    box-shadow: 0 5px 0 #1b5e20;
    font-weight: bold;
  }

  .bottom-controls { display: flex; gap: 20px; margin-bottom: 20px; }
  .header-btn {
    color: white; border: none; padding: 12px 25px; border-radius: 30px;
    cursor: pointer; font-weight: bold;
  }

  #printable-sheet { display: none; }

  @media print {
    body * { visibility: hidden; }
    #printable-sheet, #printable-sheet * { visibility: visible; color: #000 !important; }
    #printable-sheet { display: block; position: absolute; left: 0; top: 0; width: 100%; padding: 20px; }
    .sheet-question { margin-bottom: 20px; border-bottom: 1px dashed #000; padding-bottom: 10px; }
    .print-no-show { display: none !important; }
  }
</style>
</head>
<body>

<div class="header-area">
  <div class="illustration-container">
    <img id="headerImage" src="images/river.jpg" class="illustration-placeholder" alt="QuestImg">
  </div>
  <div class="title-wrapper">
    <h2 id="pageTitle">p8 Nature - Vocabulary Quiz</h2>
    <div style="color: var(--accent-green); font-weight: bold; text-align: center;">ç©´åŸ‹ã‚å•é¡Œ</div>
  </div>
</div>

<div class="container">
  <div id="questionNum" style="text-align: left; font-weight: bold; color: var(--accent-blue); margin-bottom: 10px;">Question 1/17</div>
  <div class="question-box" id="questionText">Loading...</div>
  <div class="choices-grid" id="choicesGrid"></div>
  <div id="resultMsg" style="font-weight: bold; font-size: 1.5rem; min-height: 40px;"></div>
  
  <button class="action-btn" id="checkBtn" onclick="checkAnswer()">ç­”ãˆåˆã‚ã›</button>
  <button class="action-btn" id="nextBtn" onclick="nextQuestion()" style="display:none; background-color: #ff9800; box-shadow: 0 5px 0 #e65100;">æ¬¡ã¸é€²ã‚€ â”</button>
  
  <button id="speakBtn" class="audio-btn" onclick="speakCurrentSentence()">ğŸ”Š èª­ã¿ä¸Šã’</button>
</div>

<div class="bottom-controls">
  <button class="header-btn" style="background-color: var(--accent-green);" onclick="restartQuiz()">æœ€åˆã‹ã‚‰</button>
  <button class="header-btn" style="background-color: var(--accent-brown);" onclick="window.print()">ğŸ–¨ï¸ ãƒ—ãƒªãƒ³ãƒˆ</button>
</div>

<div id="printable-sheet">
  <h1 style="text-align:center;">p8 Nature - Vocabulary Quiz</h1>
  <div style="text-align:right;">Name: ____________________</div>
  <div id="sheetContent"></div>
  <div class="print-no-show" style="margin-top: 30px; padding: 15px; background: #eee;">
    <h3>è§£ç­” (Answer Key) â€»å°åˆ·ã•ã‚Œã¾ã›ã‚“</h3>
    <div id="answerContent"></div>
  </div>
</div>

<script>
  const quizData = [
    { q: "Mr. Tanaka is fishing at the (Â  Â  Â  ).", a: "river", options: ["river", "sky", "leaf", "sun"], img: "images/river.jpg" },
    { q: "The children are swimming in the (Â  Â  Â  ).", a: "lake", options: ["lake", "star", "flower", "moon"], img: "images/lake.jpg" },
    { q: "John is skiing in the (Â  Â  Â  ).", a: "mountains", options: ["mountains", "lakes", "roses", "stars"], img: "images/mountains.jpg" },
    { q: "Misa is on the (Â  Â  Â  ). She is bathing in the sun.", a: "beach", options: ["beach", "snow", "cloud", "ocean"], img: "images/beach.jpg" },
    { q: "The children are swimming in the (Â  Â  Â  ).", a: "sea", options: ["sea", "tree", "star", "leaf"], img: "images/sea.jpg" },
    { q: "The big ship is going across the (Â  Â  Â  ).", a: "ocean", options: ["ocean", "moon", "flower", "rain"], img: "images/ocean.jpg" },
    { q: "The Christmas (Â  Â  Â  ) is beautiful.", a: "tree", options: ["tree", "sea", "river", "sky"], img: "images/tree.jpg" },
    { q: "(Â  Â  Â  ) turn color in fall.", a: "Leaves", options: ["Leaves", "Lakes", "Clouds", "Suns"], img: "images/leaves.jpg" },
    { q: "These (Â  Â  Â  ) smell nice!", a: "flowers", options: ["flowers", "snow", "moon", "mountain"], img: "images/flowers.jpg" },
    { q: "Look at the (Â  Â  Â  )! They are white!", a: "clouds", options: ["clouds", "stars", "oceans", "rivers"], img: "images/clouds.jpg" },
    { q: "Look at the (Â  Â  Â  )! It's colorful!", a: "rainbow", options: ["rainbow", "lake", "tree", "sun"], img: "images/rainbow.jpg" },
    { q: "The children are playing in the (Â  Â  Â  ).", a: "snow", options: ["snow", "leaf", "rose", "beach"], img: "images/snow.jpg" },
    { q: "The boy is walking in the (Â  Â  Â  ).", a: "rain", options: ["rain", "star", "tree", "mountain"], img: "images/rain.jpg" },
    { q: "Look at the yellow (Â  Â  Â  )!", a: "moon", options: ["moon", "sky", "river", "flower"], img: "images/moon-stars.jpg" },
    { q: "Look at the (Â  Â  Â  )! They are beautiful!", a: "stars", options: ["stars", "clouds", "moon", "rainbow"], img: "images/moon-stars.jpg" },
    { q: "The (Â  Â  Â  ) is shining brightly.", a: "sun", options: ["sun", "rain", "mountain", "moon"], img: "images/sun.jpg" },
    { q: "The (Â  Â  Â  ) is blue.", a: "sky", options: ["sky", "snow", "rose", "tree"], img: "images/sky.jpg" }
  ];

  let currentIdx = 0;
  let selectedOption = null;
  let shuffledQuizData = [];

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // ã‚¯ã‚¤ã‚ºã‚’åˆæœŸåŒ–ãƒ»ãƒªã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹é–¢æ•°
  function restartQuiz() {
    currentIdx = 0;
    // å•é¡Œãƒ‡ãƒ¼ã‚¿ã®ã‚³ãƒ”ãƒ¼ã‚’ä½œã£ã¦ã‚·ãƒ£ãƒƒãƒ•ãƒ«
    shuffledQuizData = shuffle([...quizData]);
    loadQuestion();
  }

  function loadQuestion() {
    const data = shuffledQuizData[currentIdx];
    document.getElementById('questionText').textContent = data.q;
    document.getElementById('headerImage').src = data.img;
    document.getElementById('questionNum').textContent = `Question ${currentIdx + 1} / ${shuffledQuizData.length}`;
    
    const grid = document.getElementById('choicesGrid');
    grid.innerHTML = "";
    selectedOption = null;
    document.getElementById('resultMsg').textContent = "";
    document.getElementById('checkBtn').style.display = "inline-block";
    document.getElementById('nextBtn').style.display = "none";
    document.getElementById('speakBtn').style.display = "none";

    const shuffledOptions = shuffle([...data.options]);
    shuffledOptions.forEach(opt => {
      const btn = document.createElement('button');
      btn.className = "choice-btn";
      btn.textContent = opt;
      btn.onclick = () => {
        if(document.getElementById('nextBtn').style.display === "inline-block") return;
        document.querySelectorAll('.choice-btn').forEach(b => b.classList.remove('selected', 'wrong-choice'));
        btn.classList.add('selected');
        selectedOption = opt;
        document.getElementById('questionText').textContent = data.q.replace("(Â  Â  Â  )", `( ${opt} )`);
      };
      grid.appendChild(btn);
    });
  }

  function checkAnswer() {
    if (!selectedOption) { alert("ç­”ãˆã‚’é¸ã‚“ã§ã­ï¼"); return; }
    const correct = shuffledQuizData[currentIdx].a;
    const msg = document.getElementById('resultMsg');
    
    if (selectedOption === correct) {
      document.querySelector('.choice-btn.selected').classList.add('correct-choice');
      msg.textContent = "Good job! æ­£è§£ï¼";
      msg.style.color = "#2e7d32";
      document.getElementById('checkBtn').style.display = "none";
      document.getElementById('nextBtn').style.display = "inline-block";
      document.getElementById('speakBtn').style.display = "block";

      const fullSentence = shuffledQuizData[currentIdx].q.replace("(Â  Â  Â  )", selectedOption);
      document.getElementById('questionText').textContent = fullSentence;

    } else {
      document.querySelector('.choice-btn.selected').classList.add('wrong-choice');
      msg.textContent = "Try again! ã‚‚ã†ä¸€åº¦ï¼";
      msg.style.color = "#d32f2f";
    }
  }

  function speakCurrentSentence() {
    const text = document.getElementById('questionText').textContent;
    const uttr = new SpeechSynthesisUtterance(text);
    uttr.lang = "en-US";
    uttr.rate = 0.8;
    speechSynthesis.speak(uttr);
  }

  function nextQuestion() {
    currentIdx++;
    if (currentIdx < shuffledQuizData.length) loadQuestion();
    else {
      // çµ‚äº†ç”»é¢ã®èª¿æ•´ï¼šæœ€åˆã‹ã‚‰ãƒœã‚¿ãƒ³ãŒå‹•ä½œã™ã‚‹ã‚ˆã†ã«
      document.querySelector('.container').innerHTML = "<h2>ğŸ‰ Perfect! ğŸ‰</h2><p>å…¨å•ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸï¼</p><button class='action-btn' onclick='location.reload()'>æœ€åˆã‹ã‚‰</button>";
    }
  }

  function setupPrint() {
    const sheet = document.getElementById('sheetContent');
    const ans = document.getElementById('answerContent');
    // ãƒ—ãƒªãƒ³ãƒˆç”¨ã¯ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã›ãšå…ƒã®é †ã§å‡ºåŠ›
    quizData.forEach((d, i) => {
      sheet.innerHTML += `<div class="sheet-question" style="font-size: 16pt;"><b>Q${i+1}.</b> ${d.q.replace("(Â  Â  Â  )", "( ________ )")}<br><small>[ ${d.options.join(" / ")} ]</small></div>`;
      ans.innerHTML += `Q${i+1}: ${d.a}ã€€`;
    });
  }

  // èµ·å‹•æ™‚ã«ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹
  restartQuiz();
  setupPrint();
</script>
</body>
</html>